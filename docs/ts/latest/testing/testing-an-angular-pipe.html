<!DOCTYPE html><html lang="en" ng-app="angularIOApp" itemscope itemtype="http://schema.org/Framework"><!-- template: public/docs/_layout--><head><title>测试Angular管道 - ts</title><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="description" content="Angular是一个用于构建移动应用和桌面Web应用的开发平台"/><meta name="keywords" content="Angular, 中文, 中文版, AngularJS, AngularDart, Javscript, Dart, Framework, JavaScript MVC, Google"/><meta name="robots" content="all"/><meta name="referrer" content="origin"/><meta name="viewport" id="viewport" content="width=device-width, initial-scale=1"/><meta property="og:title" content="Angular 2"/><meta property="og:image" content="/resources/images/logos/standard/shield-large.png"/><meta property="og:image:type" content="image/png"/><meta property="og:image:width" content="184"/><meta property="og:image:height" content="200"/><meta property="og:description" content="Angular是一个用于构建移动应用和桌面Web应用的开发平台"/><meta itemprop="name" content="Angular 2"/><meta itemprop="description" content="Angular是一个用于构建移动应用和桌面Web应用的开发平台"/><meta itemprop="image" content="/resources/images/logos/standard/shield-large.png"/><link rel="icon" type="image/x-icon" href="/resources/images/icons/favicon.ico"/><link rel="stylesheet" href="/resources/css/vendor/angular-material.min.css"/><link href="/resources/fonts/vendor/roboto.css" rel="stylesheet" type="text/css"/><link href="/resources/fonts/vendor/material-icons.css" rel="stylesheet"/><link rel="stylesheet" href="/resources/css/vendor/icomoon/style.css"/><link rel="stylesheet" href="/resources/css/vendor/animate.css"/><link rel="stylesheet" href="/resources/css/main.css"/><!-- MOBILE ICONS -->
<link rel="apple-touch-icon" sizes="57x57" href="/resources/images/favicons/apple-touch-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="/resources/images/favicons/apple-touch-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="/resources/images/favicons/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="/resources/images/favicons/apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="/resources/images/favicons/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="/resources/images/favicons/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="/resources/images/favicons/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="/resources/images/favicons/apple-touch-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="/resources/images/favicons/apple-touch-icon-180x180.png">
<link rel="icon" type="image/png" href="/resources/images/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/resources/images/favicons/favicon-194x194.png" sizes="194x194">
<link rel="icon" type="image/png" href="/resources/images/favicons/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/resources/images/favicons/android-chrome-192x192.png" sizes="192x192">
<link rel="icon" type="image/png" href="/resources/images/favicons/favicon-16x16.png" sizes="16x16">
<link rel="manifest" href="/resources/images/favicons/manifest.json"></head><body ng-controller="AppCtrl as appCtrl" class="l-offset-nav l-offset-side-nav"><md-toolbar scroll-y-offset-element="scroll-y-offset-element" class="main-nav background-regal l-pinned-top l-layer-5"><nav><h1><a href="/" md-button>Angular <sup>by Google</sup></a></h1><button aria-label="查看菜单" ng-click="appCtrl.toggleMainMenu($event)" md-button="md-button" class="main-nav-button main-nav-mobile-trigger l-right">网站菜单 <span class="icon icon-arrow-drop-down"></span></button><ul ng-class="appCtrl.showMainNav ? 'is-visible' : ''"><li class="l-left"><a class="main-nav-button" href="/features.html" md-button>特性</a></li><li class="l-left"><a class="main-nav-button" href="/docs/ts/latest/" md-button>文档</a></li><li class="l-left"><a class="main-nav-button" href="/events.html" md-button>会议</a></li><li class="l-left"><a class="main-nav-button" href="/news.html" md-button>新闻</a></li><li class="l-left"><a class="main-nav-button" href="/translate/cn/home.html" md-button>关于中文版</a></li><li class="l-right"><a class="main-nav-button" href="/docs/ts/latest/quickstart.html" md-button>立即开始！</a></li><li class="l-right"><a ng-click="appCtrl.toggleSource($event)" href="href" class="main-nav-button md-button ng-cloak"><span>{{appCtrl.sourceVisible?'Hide English':'Show English'}}</span></a></li></ul></nav></md-toolbar><!-- Include this file ONLY when current.path[2] is defined--><nav class="side-nav l-pinned-left l-layer-4 l-offset-nav"><!-- SEARCH BAR--><header class="side-nav-search st-input-wrapper"><form class="st-input-inner"><label for="search-io" class="is-hidden">搜索文档</label><input type="search" id="search-io" placeholder="搜索文档..."/></form><button aria-label="查看文档菜单" ng-click="appCtrl.toggleDocsMenu($event)" md-button="md-button" class="mobile-trigger button">文档 <span class="icon icon-arrow-drop-down"></span></button></header><div ng-class="appCtrl.showDocsNav ? 'is-visible' : ''" class="side-nav-secondary"><div class="nav-blocks"><a href="/docs/ts/latest/quickstart.html" title="Angular 2快速起步" class="nav-title ">快速起步</a></div><div class="nav-blocks"><a href="/docs/ts/latest/tutorial/" title="英雄指南教程带我们一步步使用TypeScript创建Angular应用。" class="nav-title ">教程<img src="/resources/images/icons/ic_keyboard_arrow_down_black_24px.svg" class="inline-arrow-down-svg"/></a><div class="nav-ordered-lists is-hidden"><ul><li class="nav-list-item "><a href="/docs/ts/latest/tutorial/" title="英雄指南教程带我们一步步使用TypeScript创建Angular应用。" class="translated-cn">1. 简介</a></li><li class="nav-list-item "><a href="/docs/ts/latest/tutorial/toh-pt1.html" title="我们构建一个简单的英雄编辑器" class="translated-cn">2. 英雄编辑器</a></li><li class="nav-list-item "><a href="/docs/ts/latest/tutorial/toh-pt2.html" title="我们构建一个主从结构的页面，用于展现英雄列表" class="translated-cn">3. 主从结构</a></li><li class="nav-list-item "><a href="/docs/ts/latest/tutorial/toh-pt3.html" title="我们把主从结构的页面重构成多个组件" class="translated-cn">4. 多个组件</a></li><li class="nav-list-item "><a href="/docs/ts/latest/tutorial/toh-pt4.html" title="我们创建一个可复用的服务来调用英雄的数据" class="translated-cn">5. 服务</a></li><li class="nav-list-item "><a href="/docs/ts/latest/tutorial/toh-pt5.html" title="我们添加一个Angular组件路由，并且学习在视图之间导航" class="translated-cn">6. 路由</a></li><li class="nav-list-item "><a href="/docs/ts/latest/tutorial/toh-pt6.html" title="把我们的服务和组件改为用Angular的HTTP服务实现" class="translated-cn">7. HTTP</a></li></ul></div></div><div class="nav-blocks"><a href="/docs/ts/latest/guide/" title="如何阅读本文档" class="nav-title ">基础知识<img src="/resources/images/icons/ic_keyboard_arrow_down_black_24px.svg" class="inline-arrow-down-svg"/></a><div class="nav-ordered-lists is-hidden"><ul><li class="nav-list-item "><a href="/docs/ts/latest/guide/" title="如何阅读本文档" class="translated-cn">1. 概览</a></li><li class="nav-list-item "><a href="/docs/ts/latest/guide/architecture.html" title="Angular 2应用的基本构造块" class="translated-cn">2. 架构</a></li><li class="nav-list-item "><a href="/docs/ts/latest/guide/displaying-data.html" title="利用插值表达式和其它形式的属性绑定机制，把数据显示到UI上。" class="translated-cn">3. 显示数据</a></li><li class="nav-list-item "><a href="/docs/ts/latest/guide/user-input.html" title="用户输入触发DOM事件。我们通过事件绑定来监听它们，把更新过的数据导入回我们的组件和model。" class="translated-cn">4. 用户输入</a></li><li class="nav-list-item "><a href="/docs/ts/latest/guide/forms.html" title="表单创建一个有机、有效、引人注目的数据输入体验。Angular表单协调一组数据绑定控件，跟踪变更，验证输入的有效性，并且显示错误信息。" class="translated-cn">5. 表单</a></li><li class="nav-list-item "><a href="/docs/ts/latest/guide/dependency-injection.html" title="Angular的依赖注入系统能够JIT(刚好及时)的创建和交付所依赖的服务。" class="translated-cn">6. 依赖注入</a></li><li class="nav-list-item "><a href="/docs/ts/latest/guide/template-syntax.html" title="学习如何写模板来显示数据，以及在数据绑定的帮助下响应用户事件。" class="translated-cn">7. 模板语法</a></li><li class="nav-list-item "><a href="/docs/ts/latest/guide/cheatsheet.html" title="一份Angular语法的快速指南" class="translated-cn">8. Angular小抄</a></li><li class="nav-list-item "><a href="/docs/ts/latest/guide/style-guide.html" title="如何写Angular2风格的程序" class="translated-cn">9. 风格指南</a></li><li class="nav-list-item "><a href="/docs/ts/latest/guide/glossary.html" title="Angular 2重要词汇的简短定义。" class="translated-cn">10. 词汇表</a></li></ul></div></div><div class="nav-blocks"><a href="/docs/ts/latest/guide/ngmodule.html" title="用@NgModule定义应用中的模块" class="nav-title ">开发指南<img src="/resources/images/icons/ic_keyboard_arrow_down_black_24px.svg" class="inline-arrow-down-svg"/></a><div class="nav-unordered-lists is-hidden"><ul><li class="nav-list-item "><a href="/docs/ts/latest/guide/ngmodule.html" title="用@NgModule定义应用中的模块" class="translated-cn">Angular模块（NgModule）</a></li><li class="nav-list-item "><a href="/docs/ts/latest/guide/animations.html" title="Angular动画系统指南。" class="translated-cn">动画</a></li><li class="nav-list-item "><a href="/docs/ts/latest/guide/attribute-directives.html" title="属性型指令把行为添加到现有元素上。" class="translated-cn">属性型指令</a></li><li class="nav-list-item "><a href="/docs/ts/latest/guide/browser-support.html" title="浏览器支持与填充（Polyfill）指南" class="translated-cn">浏览器支持</a></li><li class="nav-list-item "><a href="/docs/ts/latest/guide/component-styles.html" title="学习如何给组件应用CSS样式。" class="translated-cn">组件样式</a></li><li class="nav-list-item "><a href="/docs/ts/latest/guide/hierarchical-dependency-injection.html" title="Angular的多级依赖注入系统支持与组件树并行的嵌套式注入器。" class="translated-cn">多级注入器</a></li><li class="nav-list-item "><a href="/docs/ts/latest/guide/server-communication.html" title="通过HTTP客户端与远程服务器对话。" class="translated-cn">HTTP客户端</a></li><li class="nav-list-item "><a href="/docs/ts/latest/guide/lifecycle-hooks.html" title="Angular调用指令和组件的生命周期钩子函数，包括它的创建、变更和销毁时。" class="translated-cn">生命周期钩子</a></li><li class="nav-list-item "><a href="/docs/ts/latest/guide/npm-packages.html" title="推荐的npm包以及如何指定所依赖的包" class="translated-cn">Npm包</a></li><li class="nav-list-item "><a href="/docs/ts/latest/guide/pipes.html" title="管道可以在模板中转换显示的内容。" class="translated-cn">管道</a></li><li class="nav-list-item "><a href="/docs/ts/latest/guide/router.html" title="揭示如何通过Angular 2路由进行基本的屏幕导航。" class="translated-cn">路由与导航</a></li><li class="nav-list-item "><a href="/docs/ts/latest/guide/security.html" title="开发“内容安全”的Angular应用。" class="translated-cn">安全</a></li><li class="nav-list-item "><a href="/docs/ts/latest/guide/structural-directives.html" title="Angular有一个强力的模板引擎，它能让你轻松维护元素的DOM树结构。" class="translated-cn">结构型指令</a></li><li class="nav-list-item "><a href="/docs/ts/latest/guide/testing.html" title="Angular 2应用的测试技术与实践。" class="translated-cn">测试</a></li><li class="nav-list-item "><a href="/docs/ts/latest/guide/typescript-configuration.html" title="Angular 2开发者的TypeScript配置" class="translated-cn">TypeScript配置</a></li><li class="nav-list-item "><a href="/docs/ts/latest/guide/upgrade.html" title="Angular 1应用可以逐步升级到Angular 2。" class="translated-cn">从1.x升级</a></li><li class="nav-list-item "><a href="/docs/ts/latest/guide/webpack.html" title="使用基于Webpack的工具创建Angular 2应用" class="translated-cn">Webpack简介</a></li></ul></div></div><div class="nav-blocks"><a href="/docs/ts/latest/cookbook/" title="一组常见Angular应用场景的“烹饪宝典”" class="nav-title ">烹饪宝典<img src="/resources/images/icons/ic_keyboard_arrow_down_black_24px.svg" class="inline-arrow-down-svg"/></a><div class="nav-unordered-lists is-hidden"><ul><li class="nav-list-item "><a href="/docs/ts/latest/cookbook/" title="一组常见Angular应用场景的“烹饪宝典”" class="translated-cn">概览</a></li><li class="nav-list-item "><a href="/docs/ts/latest/cookbook/a1-a2-quick-reference.html" title="学习如何把Angular 1中的概念和技术对应到Angular 2中" class="translated-cn">Angular从1到2快速参考</a></li><li class="nav-list-item "><a href="/docs/ts/latest/cookbook/ngmodule-faq.html" title="对@NgModule常见问题的解答" class="translated-cn">Angular模块常见问题</a></li><li class="nav-list-item "><a href="/docs/ts/latest/cookbook/component-communication.html" title="在不同的指令和组件之间共享信息" class="translated-cn">组件通讯</a></li><li class="nav-list-item "><a href="/docs/ts/latest/cookbook/component-relative-paths.html" title="为组件的模板和样式指定相对于组件的路径" class="translated-cn">相对于组件的路径</a></li><li class="nav-list-item "><a href="/docs/ts/latest/cookbook/dependency-injection.html" title="依赖注入技术" class="translated-cn">依赖注入</a></li><li class="nav-list-item "><a href="/docs/ts/latest/cookbook/dynamic-form.html" title="用FormGroup渲染动态表单" class="translated-cn">动态表单</a></li><li class="nav-list-item "><a href="/docs/ts/latest/cookbook/form-validation.html" title="验证用户在表单中的输入" class="translated-cn">表单验证</a></li><li class="nav-list-item "><a href="/docs/ts/latest/cookbook/rc4-to-rc5.html" title="分分钟把RC4迁移到RC5" class="translated-cn">如何从RC4迁移到RC5</a></li><li class="nav-list-item "><a href="/docs/ts/latest/cookbook/set-document-title.html" title="使用Title服务来设置文档标题或窗口标题" class="translated-cn">设置文档标题</a></li><li class="nav-list-item "><a href="/docs/ts/latest/cookbook/ts-to-js.html" title="把Angular 2的TypeScript范例转换为ES5 JavaScript" class="translated-cn">从TypeScript到JavaScript</a></li><li class="nav-list-item "><a href="/docs/ts/latest/cookbook/visual-studio-2015.html" title="使用Visual Studio 2015快速开始" class="translated-cn">Visual Studio 2015快速开始</a></li></ul></div></div><div class="nav-blocks"><a href="/docs/ts/latest/api/" title="API参考手册" class="translated-cn nav-title ">API参考手册</a></div></div></nav><script>// Could put in appCtrl but only needed here and clear here
(function scrollToSelectedLink() {
  var sideNav = document.getElementsByClassName('side-nav')[0];
  var link = sideNav.getElementsByClassName('is-selected')[0];
  if (link && link.offsetTop > window.innerHeight) {
    sideNav.scrollTop = link.offsetTop - (window.innerHeight / 2);
    //alert("offsetTop: " + link.offsetTop + " side-nav top is " + sideNav.scrollTop);
  }
})()</script><!-- template: public/_includes/_hero--><header style="" class="hero background-sky"><div class="inner-header"><h1 class="hero-title text-display-1 translated-cn ">测试Angular管道</h1><span class="badges"></span></div><!-- DROPDOWN BUTTON --><nav class="dropdown"><button aria-label="选择Angular版本" md-button="md-button" ng-click="appCtrl.toggleVersionMenu($event)" class="dropdown-button">Angular 2 for TypeScript  <span class="icon icon-arrow-drop-down"></span></button><div ng-click="appCtrl.toggleVersionMenu($event)" ng-show="appCtrl.showMenu" class="overlay ng-hide"></div><!-- DROPDOWN MENU --><div ng-class="appCtrl.showMenu ? 'is-visible' : ''" class="dropdown-menu"><ul><li><a href="/docs/ts/latest/testing/testing-an-angular-pipe.html" md-button>Angular 2 for TypeScript </a></li></ul><ul><li><a href="/docs/js/latest/testing/testing-an-angular-pipe.html" md-button>Angular 2 for JavaScript </a></li></ul><ul><li><a href="/docs/dart/latest/testing/testing-an-angular-pipe.html" md-button>Angular 2 for Dart </a></li></ul></div></nav></header><div class="banner"><p class="text-body translated-cn">测试应用中与Angular有关的部分</p></div><article class="l-content-small grid-fluid docs-content"><div class="c10"><div class="showcase"><div class="showcase-content"><script>function why(id, backTo) {
  var id = "#"+id;
  var el = document.querySelector(id);
  el.hidden=el.hidden=!el.hidden;

  if (el.hidden && backTo){
    // the next line is required to work around a bug in WebKit (Chrome / Safari)
    location.href = "#";
    location.href =  "#" + backTo;
  }
}</script><script>function verbose(isVerbose) {
  isVerbose = !! isVerbose;
  var el = document.querySelector('button.verbose.off');
  el.style.display = isVerbose ? 'block' : 'none';
  var el = document.querySelector('button.verbose.on');
  el.style.display = isVerbose ? 'none' : 'block';

  CCSStylesheetRuleStyle('main','.l-verbose-section', 'display',
    isVerbose ? 'block' : 'none');
}
</script><script>function CCSStylesheetRuleStyle(stylesheet, selectorText, style, value){
  /* returns the value of the element style of the rule in the stylesheet
  *  If no value is given, reads the value
  *  If value is given, the value is changed and returned
  *  If '' (empty string) is given, erases the value.
  *  The browser will apply the default one
  *
  * string stylesheet: part of the .css name to be recognized, e.g. 'default'
  * string selectorText: css selector, e.g. '#myId', '.myClass', 'thead td'
  * string style: camelCase element style, e.g. 'fontSize'
  * string value optional : the new value
  */
  var CCSstyle = undefined, rules, sheet;
  for(var m in document.styleSheets){
    sheet = document.styleSheets[m];
    if(sheet.href && sheet.href.indexOf(stylesheet) != -1){
    rules = sheet[document.all ? 'rules' : 'cssRules'];
    for(var n in rules){
      console.log(rules[n].selectorText);
      if(rules[n].selectorText == selectorText){
        CCSstyle = rules[n].style;
        break;
      }
    }
    break;
    }
  }
  if(value == undefined)
    return CCSstyle[style]
  else
    return CCSstyle[style] = value
}
</script><p>We’ll test an Angular pipe in this chapter.</p>
<p>在本章中，我们将测试一个Angular管道。</p>
<p>An Angular pipe is a declarative way in HTML to transform some input into some displayable output.</p>
<p>Angular管道一种以声明的方式，在HTML中把某些输入转换成易于显示的输出。</p>
<p>We don&#39;t have a pipe though, since in Tour of Heroes we didn&#39;t create any pipes. It uses a pipe though, the <code>uppercase</code> pipe that comes with Angular 2.</p>
<p>我们还没有管道，因为在《英雄指南》中我们没有创建过任何管道。不过它用过一个来自Angular 2中的<code>uppercase</code>管道。</p>
<p>We can make our own <code>my-uppercase</code> pipe that does exactly the same as the <code>uppercase</code> pipe and test that.</p>
<p>我们可以做一个自己的<code>my-uppercase</code>管道并测试它，该管道的功能和<code>uppercase</code>管道完全相同。</p>
<p>Since we&#39;re getting ready to write some code we want to test, let&#39;s take this opportunity to talk just a little bit about <a href="https://en.wikipedia.org/wiki/Test-driven_development">Test Driven Development</a>. There&#39;s a lot written about this topic so we don&#39;t want to have an exhaustive description here, but rather a practical application.</p>
<p>既然我们准备写一些待测试的代码，那就趁机讲一点关于<a href="https://en.wikipedia.org/wiki/Test-driven_development">测试驱动开发(TDD)</a>的知识吧。
关于这个主题已经有了大量的著述，我们这里也就不再全面描述它了，而只是针对一个实际的应用来讲。</p>
<p>We already know <em>exactly</em> what we want the <code>uppercase</code> pipe to do. We could say our ...expectations... of it are very well defined.</p>
<p>我们已经<em>确切的</em>知道<code>uppercase</code>应该做什么。可以说，我们对它的……预期行为……是有良好定义的(well defined)。</p>
<p>We always use expectations our expectations to guide development, but sometimes it&#39;s hard to see the forest for the trees when we&#39;re right in the middle of coding. This is especially evident in larger tasks.</p>
<p>我们总是使用自己的预期(Expectation)来指导开发，但是有时候，也很容易见木不见林，特别是我们的代码走到中途的时候。在大型任务中，这种情况尤为明显。</p>
<p>So one thing we can do is put those expectations down as cold hard test code. We were going to test things manually anyway, so doing it <em>before</em> we have even one line of code isn&#39;t going to hurt.</p>
<p>我们所能做的就是把这些预期落实到冰冷的测试代码上。反正无论如何我们都会手动测试它们，那么在连一行代码都没有的时候写点测试代码也不会带来什么问题。</p>
<p>Worst thing that can happen is have that test fail, but on the way to fixing it we&#39;ll end up creating our pipe. So in a sense, the failing test will <em>tell you what it wants</em> to pass.</p>
<p>最坏的结果也只是测试会失败，但在我们创建管道的过程中，会逐渐修复它。于是，在这个意义上，失败的测试会<em>告诉我们它要的是什么</em>。</p>
<p>We&#39;re just putting down expectations, nothing more. If we were to put them down on paper, they would look like this:</p>
<p>我们只要写下这些预期就行了，不用多。如果把它们写在纸上，大概是这样的：</p>
<pre><code>  MyUppercasePipe
    transforms &quot;abc&quot; to &quot;ABC&quot;
    transforms &quot;abc def&quot; to &quot;ABC DEF&quot;
    leaves &quot;ABC DEF&quot; unchanged
</code></pre><p>All we need to know to put down our expectations as code is how a pipe class looks like from the outside. From the <a href="pipes#custom-pipes">pipe developer guide</a> we know that a pipe implements a <code>transform</code> method.</p>
<p>我们需要知道的一切就是：把我们的预期用代码的形式写下来，就意味着这个管道类从外界看起来应该是什么样的。
从<a href="pipes#custom-pipes">管道开发指南</a>中，我们知道管道实现了一个<code>transform</code>方法。</p>
<p>Putting it down as Jasmine expectations, they would look something like this:</p>
<p>把它写成Jasmine中的“预期”，它们看起来是这样的：</p>
<code-example language="ts" format="linenums">it(&#39;transforms &quot;abc&quot; to &quot;ABC&quot;&#39;, () =&gt; {
  expect(pipe.transform(&#39;abc&#39;)).toEqual(&#39;ABC&#39;);
});

it(&#39;transforms &quot;abc def&quot; to &quot;ABC DEF&quot;&#39;, () =&gt; {
  expect(pipe.transform(&#39;abc def&#39;)).toEqual(&#39;ABC DEF&#39;);
});

it(&#39;leaves &quot;ABC DEF&quot; unchanged&#39;, () =&gt; {
  expect(pipe.transform(&#39;ABC DEF&#39;)).toEqual(&#39;ABC DEF&#39;);
});
</code-example><p>In this chapter we will:</p>
<p>在本章中，我们将：</p>
<ul>
<li><p>create a test before creating a class</p>
</li>
<li><p>在创建类之前创建一个测试</p>
</li>
<li><p>load multiple test files in our test harness, using system.js</p>
</li>
<li><p>使用SystemJS把多个测试文件加载到我们的测试挽具中</p>
</li>
<li><p>add the Angular 2 library to our test harness</p>
</li>
<li><p>往我们的测试挽具中添加Angular 2库</p>
</li>
<li><p>watch the new test fail, and fix it</p>
</li>
<li><p>监视新测试，如果失败，就修复它</p>
</li>
</ul>
<div class="callout is-helpful"><header>Prior Knowledge</header><header>准备知识</header><p>The Unit Testing chapters build upon each other. We recommend reading them in order.
We&#39;re also assuming that you&#39;re already comfortable with basic Angular 2 concepts and the tools
we introduced in the <a href="../quickstart.html">QuickStart</a> and
the <a href="../tutorial/">Tour of Heroes</a> tutorial
such as <code>npm</code>, <code>gulp</code>, and <code>lite-server</code>.</p>
<p>这一章单元测试是在其它章节的基础上写的。我们建议你按顺序阅读它们。同时，我们假设你已经对Angular 2的原理、<a href="../quickstart.html">“快速起步”</a>和
<a href="../tutorial">英雄指南</a>中介绍的<code>npm</code>、<code>gulp</code>和<code>lite-server</code>等工具都已经有所了解。</p>
</div><h2 id="add-another-spec-file">Add another spec file</h2>
<h2 id="-">添加另一个规约文件</h2>
<p><strong>Create</strong> a <code>my-uppercase.pipe.spec.ts</code> in <code>app/</code>.</p>
<p>在<code>app/</code>中创建一个<code>my-uppercase.pipe.spec.ts</code>文件。</p>
<p><strong>Stop and restart the TypeScript compiler</strong> to ensure we compile the new file.</p>
<p><strong>停止并重新启动TypeScript编译器</strong>以确保我们能编译这个新文件。</p>
<p><strong>Add</strong> the following lines of rather obvious Jasmine test code.</p>
<p><strong>添加</strong>下面这些直白的Jasmine测试代码。</p>
<div class="example-title">app/my-uppercase.pipe.spec.ts</div><code-example language="ts" format="linenums">import { MyUppercasePipe } from &#39;./my-uppercase.pipe&#39;;

describe(&#39;MyUppercasePipe&#39;, () =&gt; {
  let pipe: MyUppercasePipe;

  beforeEach(() =&gt; {
    pipe = new MyUppercasePipe();
  });

  it(&#39;transforms &quot;abc&quot; to &quot;ABC&quot;&#39;, () =&gt; {
    expect(pipe.transform(&#39;abc&#39;)).toEqual(&#39;ABC&#39;);
  });

  it(&#39;transforms &quot;abc def&quot; to &quot;ABC DEF&quot;&#39;, () =&gt; {
    expect(pipe.transform(&#39;abc def&#39;)).toEqual(&#39;ABC DEF&#39;);
  });

  it(&#39;leaves &quot;ABC DEF&quot; unchanged&#39;, () =&gt; {
    expect(pipe.transform(&#39;ABC DEF&#39;)).toEqual(&#39;ABC DEF&#39;);
  });
});
</code-example><p>Note that each test is short (one line in our case).
It has a clear label that accurately describes the test. And it makes exactly one expectation.</p>
<p>注意，每个测试都很短(在这里是一行)。
它有一个清晰的用来精确描述本测试的标签，并且只表达一条期待。</p>
<p>Anyone can read these tests and understand quickly what the test does and what the pipe does.
If one of the tests fails, we know which expected behavior is no longer true.
We’ll have little trouble maintaining these tests and adding more like them as we encounter new conditions to explore.</p>
<p>任何人都可以读这些测试，并快速理解这个测试是做什么的，以及这个管道是做什么的。
如果这些测试之一失败了，我们就知道它所期待的行为出问题了。
要维护这些测试我们会遇到一些小麻烦，并且如果我们遇到了需要探索的新条件，还得添加更多类似的测试。</p>
<p>That’s the way we like our tests!</p>
<p>但这就是我们关爱这些测试的方式！</p>
<h2 id="add-this-spec-to-unit-tests-html-">Add this spec to <code>unit-tests.html</code></h2>
<h2 id="-unit-tests-html-">把规约添加到<code>unit-tests.html</code>中</h2>
<p>Now let’s wire our new spec file into the HTML test harness.</p>
<p>现在，让我们把这个新的规约文件放进这个HTML测试挽具中。</p>
<p>Open <code>unit-tests.html</code>. Find <code>System.import(&#39;app/hero.spec&#39;)</code>.</p>
<p>打开<code>unit-tests.html</code>。查找<code>System.import(&#39;app/hero.spec&#39;)</code>。</p>
<p>Hmm. We can’t just add <code>System.import(&#39;app/my-uppercase.pipe.spec&#39;)</code>.</p>
<p>恩……我们不能只添加<code>System.import(&#39;app/my-uppercase.pipe.spec&#39;)</code>。</p>
<p>The first <code>System.import</code> returns a promise as does this second import.
We can’t run any of the Jasmine tests until <strong>both imports are finished</strong>.</p>
<p>第一个<code>System.import</code>返回一个承诺(promise)，第二个也一样。
直到<strong>这两个<code>import</code>都执行完</strong>，Jasmine的测试才会开始运行。</p>
<p>Fortunately, we can create a new <code>Promise</code> that wraps both import promises and waits
for both to finish loading.</p>
<p>幸运的是，我们可以创建一个新的<code>Promise</code>来包装这两个<code>import</code>语句返回的承诺，并等它们两个加载结束。</p>
<code-example language="html" format="">&lt;script&gt;
  // #2. Import the spec files explicitly
  Promise.all([
    System.import(&#39;app/hero.spec&#39;),
    System.import(&#39;app/my-uppercase.pipe.spec&#39;)
  ])

    // #3. wait for all imports to load ...
    //     then re-execute `window.onload` which
    //     triggers the Jasmine test-runner start
    //     or explain what went wrong.
    .then(window.onload)
    .catch(console.error.bind(console));
&lt;/script&gt;
</code-example><p>We have a pattern for adding new tests.</p>
<p>这下我们有了一种添加新测试的模式。</p>
<p>In future, when we add a new spec, we add another <code>System.import(&#39;app/some.spec&#39;)</code> to
the array argument passed to <code>Promise.all</code>.</p>
<p>将来我们再添加新的规约时，只要往传给<code>Promise.all</code>的数组参数中添加另一个<code>System.import(&#39;app/some.spec&#39;)</code>语句就可以了。</p>
<p>Try it. The browser should refresh and show the following in the console:</p>
<p>试一下。浏览器会刷新，并在控制台中显示如下内容：</p>
<code-example format="" language="html" escape="html">GET http://localhost:8080/app/my-uppercase.pipe.js 404 (Not Found)
</code-example><p>Our test failed, as expected. We&#39;re importing something that doesn&#39;t exist and our test fails saying that. All is going according to plan.</p>
<p>如预期的一样，测试失败了。我们在导入一些不存在的东西，就像测试的失败信息中所说的那样。一切都在按照计划发生。</p>
<h2 id="the-pipe-if-you-please">The pipe, if you please</h2>
<h2 id="-">管道，请上场</h2>
<p>The test is asking for a pipe, and we shall deliver.</p>
<p>这个测试需要一个管道，我们这就给它。</p>
<p><strong>Create</strong> a <code>my-uppercase.pipe.ts</code> in <code>app/</code>.</p>
<p>在<code>app/</code>中<strong>创建</strong>一个<code>my-uppercase.pipe.ts</code>文件。</p>
<p><strong>Stop and restart the TypeScript compiler</strong> to ensure we compile the new file.</p>
<p><strong>停止并重启TypeScript编译器</strong>，以确保我们能编译这个新文件。</p>
<p><strong>Add</strong> a basic pipe that doesn&#39;t do anything. We know how to make strings uppercase, but we since we&#39;re letting the test take the lead let&#39;s wait for it to tell us what&#39;s next. Maybe it&#39;ll surprise us.</p>
<p><strong>添加</strong>一个什么也不做的基本管道。我们知道该如何让字符串变大写，但由于要让测试先行，所以就让测试来告诉我们下一步做什么。也许它会带给我们一些惊喜。</p>
<div class="example-title">app/my-uppercase.pipe.ts</div><code-example language="ts" format="linenums">import { Pipe, PipeTransform } from &#39;@angular/core&#39;;

@Pipe({ name: &#39;my-uppercase&#39; })
export class MyUppercasePipe implements PipeTransform {
  transform(value: string) {
    return value;
  }
}
</code-example><p>Reload our test page and...</p>
<p>刷新我们的测试页面，并且……</p>
<code-example format="" language="html" escape="html">GET http://localhost:8080/angular2/core 404 (Not Found)
</code-example><h2 id="the-angular-library-if-you-please">The Angular library, if you please</h2>
<h2 id="angular-">Angular库，请上场</h2>
<p>Looking back at <code>unit-tests.html</code> we realize that we have not loaded the Angular library.
Yet we were able to load and test the application’s <code>Hero</code> interface.</p>
<p>往回看<code>unit-tests.html</code>，我们认识到自己还没加载过Angular库。
但是我们可以加载和测试应用中<code>Hero</code>接口的测试了。</p>
<p><strong>We were lucky!</strong>  The <code>Hero</code> interface has no dependence on Angular.
If it had depended on Angular, we’d still be staring at the Jasmine “big-time fail” screen:</p>
<p><strong>那是我们幸运！</strong><code>Hero</code>接口并不依赖Angular。
如果它依赖于Angular，我们就得面对Jasmine的“大败局”界面了(译注：因为在运行任何测试之前就出现了错误，所以没有任何测试会执行，参见<a href="#run-and-fail">运行，并失败</a>)：</p>
<figure class="image-display"><img src="/resources/images/devguide/testing-an-angular-pipe/big-time-fail-screen.png" alt="Jasmine's' big time fail screen"></figure><p>We are writing an Angular application after all and
we were going to need Angular sooner or later. That time has come.</p>
<p>毕竟我们写的是Angular程序，迟早会需要Angular登场。对，就是现在！</p>
<p><code>MyUppercasePipe</code> depends on Angular as is clear in the first few lines:</p>
<p>在开始的寥寥几行中，<code>MyUppercasePipe</code>对Angular的依赖就清晰可见了：</p>
<code-example language="ts" format="">import { Pipe, PipeTransform } from &#39;@angular/core&#39;;
</code-example><p><strong>Open</strong> <code>unit-tests.html</code></p>
<p><strong>打开</strong><code>unit-tests.html</code></p>
<p><strong>Find</strong> the <code>&lt;!-- #1. add the system.js library --&gt;</code> comment.</p>
<p><strong>查找</strong><code>&lt;!-- #1. add the system.js library --&gt;</code>注释。</p>
<p><strong>Replace</strong> the scripts tags beneath it with the all the needed angular scripts:</p>
<p>把它下方的<code>script</code>标记<strong>替换成</strong>这些所需的Angular脚本：</p>
<code-example language="html" format="">&lt;!-- #1. add the system.js and angular libraries --&gt;
  &lt;script src=&quot;node_modules/zone.js/dist/zone.js&quot;&gt;&lt;/script&gt;
  &lt;script src=&quot;node_modules/reflect-metadata/Reflect.js&quot;&gt;&lt;/script&gt;
  &lt;script src=&quot;node_modules/systemjs/dist/system.src.js&quot;&gt;&lt;/script&gt;

  &lt;script src=&quot;systemjs.config.js&quot;&gt;&lt;/script&gt;
</code-example><p>We should now be ready to see our 3 expectations fail when reloading our test page.</p>
<p>当刷新测试页面时，我们会期待看到三条期待都落空了。</p>
<figure class="image-display"><img src="/resources/images/devguide/testing-an-angular-pipe/two-failures.png" alt="2 failed tests"></figure><h2 id="uppercase-if-you-please">Uppercase, if you please</h2>
<h2 id="uppercase-">Uppercase，请上场</h2>
<p>The first two tests that passed were our old <code>hero</code> interface tests, so it makes sense that those passed. Of our three new expectations, one still passed though.</p>
<p>前两个通过的测试是我们以前的<code>hero</code>接口测试，所以它们的通过是有意义的。当然，这三条新的期待中，有一条还是通过了。</p>
<pre><code>  MyUppercasePipe
    transforms &quot;abc&quot; to &quot;ABC&quot;
    transforms &quot;abc def&quot; to &quot;ABC DEF&quot;
    leaves &quot;ABC DEF&quot; unchanged
</code></pre><p>Ah but of course! Our simple pipe doesn&#39;t transform the input at all, and the third test expected
input to not be changed.</p>
<p>啊，当然！我们这个简单的管道还完全没有转换输入，而第三条测试期待的是输入内容没变化。</p>
<p>All we have to do now is actually transform text to uppercase in our pipe.</p>
<p>我们现在要做的一切，实际上是在我们的管道中把这些文本转换成大写。</p>
<code-example language="ts" format="">transform(value: string) {
  return value.toUpperCase();
}
</code-example><p>Are we done now?</p>
<p>现在，我们完成了吗？</p>
<figure class="image-display"><img src="/resources/images/devguide/testing-an-angular-pipe/zero-failures.png" alt="0 failed tests"></figure><p>The glorious green is back with us again!</p>
<p>我们光荣的绿条又回来了！</p>
<p>We tried a bit of test driven development and it seems to have guided us to success.</p>
<p>我们尝试了一点点测试驱动开发，看起来它确实指导我们走向了成功。</p>
<p>But it&#39;s not always feasible. For instance, sometimes we need to write tests for existing functionality, like what we&#39;re about to do with the rest of Tour of Heroes.</p>
<p>但这也并不总是可行的。比如，有时我们需要为现有功能写测试，就像我们即将对《英雄指南》的其余部分所做的那样。</p>
<p>If we are writing new code though, writing tests might just be what we need to help us track our progress and keep the end result in sight at all times.</p>
<p>如果我们正在写新代码，写测试可以帮助我们追踪进度和保持最终结果全程可见。</p>
<h2 id="what-s-next-">What’s Next?</h2>
<h2 id="-">接下来呢？</h2>
<p>Now we can test parts of our application that we <em>load</em> asynchronously with system.js.</p>
<p>现在，我们可以测试应用程序中的各个部分，我们可以用system.js来异步<em>加载</em>它们。</p>
<p>What about testing parts that <em>are themselves asynchronous</em>?</p>
<p>如果这些要测试的部分<em>本身就是异步的</em>呢？</p>
<p>Let&#39;s test a service with a public asynchronous method that fetches heroes from a remote server.</p>
<p>我们来测试一个带有异步方法的服务，它会从远端服务器中获取英雄列表。</p></div></div></div></article><div class="main-footer"><nav class="background-blue-grey-900 grid-fluid"><div class="c3 main-footer-branding"><div class="logo-inverse-large"></div></div><div class="c2"><h3 class="text-headline">RESOURCES</h3><h3 class="text-headline">资源库</h3><ul class="text-body"><!-- TODO: (ericjim) make a libraries page to showcase all angular 2 libraries--><!--li <a href="/libraries.html">Libraries</a>--><li><a href="/about/">About</a></li><li><a href="/about/">关于</a></li><li><a href="/resources/">Books & Training</a></li><li><a href="/resources/">书籍与培训</a></li><li><a href="/resources/">Tools & Libraries</a></li><li><a href="/resources/">工具与库</a></li><li><a href="/resources/">Community</a></li><li><a href="/resources/">社区</a></li><li><a href="/presskit.html">Press Kit</a></li><li><a href="/presskit.html">宣传资料</a></li></ul></div><div class="c2"><h3 class="text-headline">HELP</h3><h3 class="text-headline">帮助</h3><ul class="text-body"><li><a href="http://stackoverflow.com/questions/tagged/angular2">Stack Overflow</a></li><li><a href="http://stackoverflow.com/questions/tagged/angular2">Stack Overflow</a></li><li><a href="https://gitter.im/angular/angular">Gitter</a></li><li><a href="https://gitter.im/angular/angular">Gitter</a></li><li><a href="https://groups.google.com/forum/#!forum/angular"> Google Group</a></li><li><a href="https://groups.google.com/forum/#!forum/angular"> Google Group</a></li><li><a href="https://github.com/angular/angular/issues"> Report Issues</a></li><li><a href="https://github.com/angular/angular/issues"> 报告问题</a></li><li><a class="footer-feedback" ng-click="appCtrl.openFeedback()" aria-label="Submit feedback on this page"> Site Feedback</a></li><li><a class="footer-feedback" ng-click="appCtrl.openFeedback()" aria-label="Submit feedback on this page"> 网站反馈</a></li></ul></div><div class="c2"><h3 class="text-headline">COMMUNITY</h3><h3 class="text-headline">社区</h3><ul class="text-body"><li><a href="/events.html">Events</a></li><li><a href="/events.html">会议</a></li><li><a href="http://www.meetup.com/topics/angularjs/">Meetups</a></li><li><a href="http://www.meetup.com/topics/angularjs/">Meetups</a></li><li><a href="https://twitter.com/angularjs"> Twitter</a></li><li><a href="https://twitter.com/angularjs"> Twitter</a></li><li><a href="https://github.com/angular/angular"> GitHub</a></li><li><a href="https://github.com/angular/angular"> GitHub</a></li><li><a href="/contribute.html"> Contribute</a></li><li><a href="/contribute.html"> 做贡献</a></li></ul></div><div class="c2"><h3 class="text-headline">LANGUAGES</h3><h3 class="text-headline">其它语种</h3><ul class="text-body"><li><a href="https://angular.io/" target="_blank">English</a></li></ul></div></nav><footer class="background-steel"><p><small class="text-caption">Powered by Google ©2010-2016. Code licensed under an <a href="/license" class="text-snow">MIT-style License</a>. Documentation licensed under <a class="text-snow" href="http://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a>.</small></p><p><small class="text-caption translated-cn">Powered by Google ©2010-2016. 代码授权协议：<a href="/license" class="text-snow">MIT式协议</a>。 文档授权协议：<a class="text-snow" href="http://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a>.</small></p><a aria-label="View Style Guide" href="/docs/ts/latest/styleguide.html" title="Style Guide" md-button="md-button" class="styleguide-trigger text-snow"><span class="icon-favorite"></span></a><a aria-label="查看风格指南" href="/docs/ts/latest/styleguide.html" title="风格指南" md-button="md-button" class="styleguide-trigger text-snow translated-cn"><span class="icon-favorite"></span></a><p> <small class="text-caption">本网站由洛阳永欣维护 &nbsp;<a href="http://www.miitbeian.gov.cn/">豫ICP备16019859号-1</a></small></p></footer></div><!-- VENDORS --><script src="/resources/js/vendor/prettify.js"></script><script src="/resources/js/vendor/lang-basic.js"></script><script src="/resources/js/vendor/lang-dart.js"></script><script src="/resources/js/vendor/lodash.js"></script><script src="/resources/js/vendor/clipboard.min.js"></script><!-- Angular Material Dependencies --><script src="/resources/js/vendor/angular.min.js"></script><script src="/resources/js/vendor/angular-animate.min.js"></script><script src="/resources/js/vendor/angular-aria.min.js"></script><script src="/resources/js/vendor/angular-material.min.js"></script><!-- Firebase -->
<script src="/resources/js/vendor/firebase.js"></script>
<!-- AngularFire -->
<script src="/resources/js/vendor/angularfire.min.js"></script>
<!-- Angular.io Site JS --><script src="/translate/cn/translate.js"></script><script src="/resources/js/site.js"></script><script src="/resources/js/util.js"></script><script src="/resources/js/controllers/app-controller.js"></script><script src="/resources/js/controllers/resources-controller.js"></script><script src="/resources/js/directives/cheatsheet.js"></script><script src="/resources/js/directives/api-list.js"></script><script src="/resources/js/directives/bio.js"></script><script src="/resources/js/directives/bold.js"></script><script src="/resources/js/directives/code.js"></script><script src="/resources/js/directives/copy.js"></script><script src="/resources/js/directives/code-tabs.js"></script><script src="/resources/js/directives/code-pane.js"></script><script src="/resources/js/directives/code-example.js"></script><script src="/resources/js/directives/if-docs.js"></script><script src="/resources/js/directives/live-example.js"></script><script src="/resources/js/directives/ngio-ex-path.js"></script><script src="/resources/js/directives/scroll-y-offset-element.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-80456300-1', 'auto');
ga('send', 'pageview');</script></body></html>